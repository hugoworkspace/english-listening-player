# è½¯ä»¶é—®é¢˜ä¿®å¤æ€»ç»“

## å·²ä¿®å¤çš„é—®é¢˜

### 1. å¤è¯»è®¡æ•°é€»è¾‘é—®é¢˜
**é—®é¢˜æè¿°**: è®¾ç½®å¤è¯»3æ¬¡åï¼Œåªæœ‰ç¬¬ä¸€å¥å¤è¯»äº†3æ¬¡ï¼Œè‡ªåŠ¨è·³è½¬ä¸‹ä¸€å¥åå°±åªè¯»äº†ä¸€æ¬¡å°±è·³åˆ°ä¸‹ä¸€å¥äº†ã€‚

**æ ¹æœ¬åŸå› **: å¤è¯»è®¡æ•°åœ¨åˆ‡æ¢åˆ°ä¸‹ä¸€å¥æ—¶æ²¡æœ‰é‡ç½®ï¼Œå¯¼è‡´åç»­å¥å­çš„å¤è¯»è®¡æ•°ä¸æ­£ç¡®ã€‚

**ä¿®å¤æ–¹æ¡ˆ**:
- åœ¨ `start_playing_current_sentence()` æ–¹æ³•ä¸­æ·»åŠ äº† `self.vlc_player.reset_repeat_count()` è°ƒç”¨
- ç¡®ä¿æ¯æ¬¡å¼€å§‹æ’­æ”¾æ–°å¥å­æ—¶ï¼Œå¤è¯»è®¡æ•°éƒ½ä»0å¼€å§‹

**ä¿®å¤ä»£ç **:
```python
def start_playing_current_sentence(self):
    """å¼€å§‹æ’­æ”¾å½“å‰å¥å­"""
    current_sub = self.subtitle_parser.get_current_subtitle()
    if current_sub and self.current_media_path:
        # åœæ­¢ä¹‹å‰çš„å¾ªç¯
        self.vlc_player.stop_loop()
        
        # é‡ç½®å¤è¯»è®¡æ•°
        self.vlc_player.reset_repeat_count()
        
        # è®¾ç½®å¾ªç¯æ’­æ”¾
        self.vlc_player.set_loop(current_sub['start'], current_sub['end'])
        
        # å¼€å§‹æ’­æ”¾
        if self.vlc_player.play():
            self.play_pause_btn.setText("æš‚åœ")
            self.update_subtitle_display()
```

### 2. å¤è¯»é—´éš”åŠŸèƒ½é—®é¢˜
**é—®é¢˜æè¿°**: å¤è¯»é—´éš”çš„è®¾ç½®æ²¡æœ‰èµ·æ•ˆï¼Œæ¯æ¬¡å¤è¯»è¿˜æ˜¯æ— é—´éš”ã€‚ç”¨æˆ·æŒ‡çš„æ˜¯æ¯å¥å†…éƒ¨çš„å¤šæ¬¡å¤è¯»ä¹‹é—´çš„é—´éš”ï¼Œè€Œä¸æ˜¯å¥ä¸å¥ä¹‹é—´çš„é—´éš”ã€‚

**æ ¹æœ¬åŸå› **: å¤è¯»é—´éš”é€»è¾‘åªå¤„ç†äº†å¤è¯»å®Œæˆåçš„é—´éš”ï¼Œæ²¡æœ‰å¤„ç†æ¯å¥å†…éƒ¨å¤šæ¬¡å¤è¯»ä¹‹é—´çš„é—´éš”ã€‚

**ä¿®å¤æ–¹æ¡ˆ**:
- åœ¨ `_check_loop_position()` æ–¹æ³•ä¸­ï¼Œå½“è¿˜æœ‰å¤è¯»æ¬¡æ•°ä¸”è®¾ç½®äº†å¤è¯»é—´éš”æ—¶ï¼Œæš‚åœæ’­æ”¾ç­‰å¾…é—´éš”æ—¶é—´
- ä¿®æ”¹ `_handle_repeat_complete()` æ–¹æ³•ï¼ŒåŒºåˆ†å¤è¯»é—´éš”å’Œå¤è¯»å®Œæˆä¸¤ç§æƒ…å†µ

**ä¿®å¤ä»£ç **:
```python
def _check_loop_position(self):
    """æ£€æŸ¥å¾ªç¯ä½ç½®ï¼Œå®ç°è‡ªåŠ¨å¾ªç¯"""
    if self.is_looping and self.is_playing:
        current_pos = self.get_current_position()
        
        # å¦‚æœæ’­æ”¾ä½ç½®è¶…è¿‡å¾ªç¯ç»“æŸç‚¹ï¼Œè·³å›å¾ªç¯å¼€å§‹ç‚¹
        if current_pos >= self.loop_end:
            # æ›´æ–°å¤è¯»è®¡æ•°
            self.current_repeat += 1
            
            # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è®¾å®šçš„å¤è¯»æ¬¡æ•°
            if self.repeat_count > 0 and self.current_repeat >= self.repeat_count:
                # è¾¾åˆ°å¤è¯»æ¬¡æ•°ï¼Œåœæ­¢å¾ªç¯
                self.stop_loop()
                # å¦‚æœæœ‰å¤è¯»é—´éš”ï¼Œå…ˆæš‚åœæ’­æ”¾ï¼Œç­‰å¾…é—´éš”æ—¶é—´
                if self.repeat_interval > 0:
                    self.pause()  # æš‚åœæ’­æ”¾
                    self.repeat_timer.start(self.repeat_interval * 1000)
                else:
                    self._handle_repeat_complete()
            else:
                # å¦‚æœè¿˜æœ‰å¤è¯»æ¬¡æ•°ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦é—´éš”
                if self.repeat_interval > 0 and self.current_repeat > 0:
                    # æš‚åœæ’­æ”¾ï¼Œç­‰å¾…é—´éš”æ—¶é—´åå†ç»§ç»­
                    self.pause()
                    self.repeat_timer.start(self.repeat_interval * 1000)
                else:
                    # ç»§ç»­å¾ªç¯æ’­æ”¾
                    self.set_media_position(self.loop_start)

def _handle_repeat_complete(self):
    """å¤„ç†å¤è¯»å®Œæˆåçš„é€»è¾‘"""
    self.repeat_timer.stop()
    
    # æ£€æŸ¥æ˜¯å¤è¯»é—´éš”è¿˜æ˜¯å¤è¯»å®Œæˆ
    if self.current_repeat < self.repeat_count:
        # è¿™æ˜¯å¤è¯»é—´éš”ï¼Œç»§ç»­æ’­æ”¾
        self.set_media_position(self.loop_start)
        self.play()
    else:
        # è¿™æ˜¯å¤è¯»å®Œæˆï¼Œå¦‚æœè®¾ç½®äº†è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€å¥ï¼Œè§¦å‘ä¸‹ä¸€å¥
        if self.auto_next:
            # å‘å°„ä¿¡å·é€šçŸ¥ä¸»çª—å£
            self.repeat_completed.emit()
```

## å½“å‰åŠŸèƒ½çŠ¶æ€

### âœ… æ­£å¸¸å·¥ä½œåŠŸèƒ½
1. **æ–‡ä»¶è§£æ**: æ”¯æŒå¤šç§è§†é¢‘/éŸ³é¢‘æ ¼å¼å’ŒSRTå­—å¹•æ–‡ä»¶
2. **ç²¾ç¡®å¤è¯»**: åŸºäºSRTæ—¶é—´æˆ³åœ¨æ¯å¥è¯çš„Aç‚¹å’ŒBç‚¹ä¹‹é—´è‡ªåŠ¨å¾ªç¯æ’­æ”¾
3. **å¤è¯»è®¡æ•°**: æ¯å¥éƒ½èƒ½æ­£ç¡®æŒ‰ç…§è®¾å®šçš„å¤è¯»æ¬¡æ•°æ’­æ”¾
4. **å¤è¯»é—´éš”**: å¤è¯»å®Œæˆåä¼šæš‚åœè®¾å®šçš„é—´éš”æ—¶é—´
5. **è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€å¥**: å¤è¯»å®Œæˆåè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€å¥
6. **æ’­æ”¾æ§åˆ¶**: æ’­æ”¾/æš‚åœã€ä¸Šä¸€å¥ã€ä¸‹ä¸€å¥
7. **è½¯ä»¶è®¾ç½®**: å­—ä½“å¤§å°/å®¶æ—è‡ªå®šä¹‰ï¼Œé…ç½®æŒä¹…åŒ–ä¿å­˜
8. **ç”¨æˆ·ç•Œé¢**: ç°ä»£åŒ–æ·±è‰²ä¸»é¢˜ï¼Œåº•éƒ¨æ§åˆ¶æ è®¾è®¡

### ğŸ”§ ä¿®å¤éªŒè¯
- è®¾ç½®å¤è¯»3æ¬¡ï¼Œæ¯å¥éƒ½ä¼šæ­£ç¡®å¤è¯»3æ¬¡
- è®¾ç½®å¤è¯»é—´éš”2ç§’ï¼Œå¤è¯»å®Œæˆåä¼šæš‚åœ2ç§’å†ç»§ç»­
- è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€å¥åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- æ‰€æœ‰è®¾ç½®éƒ½èƒ½æ­£ç¡®ä¿å­˜å’ŒåŠ è½½

## ä½¿ç”¨å»ºè®®

### æœ€ä½³å®è·µè®¾ç½®
1. **å¤è¯»æ¬¡æ•°**: å»ºè®®è®¾ç½®3-5æ¬¡ï¼Œæ ¹æ®ä¸ªäººå­¦ä¹ éœ€æ±‚è°ƒæ•´
2. **å¤è¯»é—´éš”**: å»ºè®®è®¾ç½®2-5ç§’ï¼Œç»™è‡ªå·±ç•™å‡ºè·Ÿè¯»å’Œæ€è€ƒçš„æ—¶é—´
3. **è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€å¥**: å»ºè®®å¼€å¯ï¼Œæé«˜å­¦ä¹ æ•ˆç‡

### æµ‹è¯•æ–¹æ³•
1. æ‰“å¼€è½¯ä»¶è®¾ç½®ï¼Œè®¾ç½®å¤è¯»æ¬¡æ•°ä¸º3ï¼Œå¤è¯»é—´éš”ä¸º2ç§’
2. é€‰æ‹©è§†é¢‘æ–‡ä»¶å’ŒSRTå­—å¹•æ–‡ä»¶
3. è§‚å¯Ÿæ¯å¥æ˜¯å¦éƒ½å¤è¯»3æ¬¡ï¼Œå¤è¯»å®Œæˆåæ˜¯å¦æš‚åœ2ç§’
4. éªŒè¯è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€å¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

## æŠ€æœ¯æ¶æ„æ”¹è¿›

### ä¿¡å·æœºåˆ¶
- ä½¿ç”¨PyQt5çš„ä¿¡å·æœºåˆ¶å®ç°æ’­æ”¾å™¨ä¸ä¸»çª—å£çš„é€šä¿¡
- `repeat_completed` ä¿¡å·åœ¨å¤è¯»å®Œæˆæ—¶è§¦å‘è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€å¥

### çŠ¶æ€ç®¡ç†
- å¤è¯»è®¡æ•°åœ¨æ¯å¥å¼€å§‹æ—¶é‡ç½®ï¼Œç¡®ä¿æ¯å¥éƒ½èƒ½æ­£ç¡®è®¡æ•°
- æ’­æ”¾çŠ¶æ€åœ¨å¤è¯»é—´éš”æœŸé—´æ­£ç¡®ç®¡ç†ï¼ˆæš‚åœçŠ¶æ€ï¼‰

### é…ç½®æŒä¹…åŒ–
- æ‰€æœ‰è®¾ç½®è‡ªåŠ¨ä¿å­˜åˆ° `english_player_config.json`
- é‡å¯è½¯ä»¶åè‡ªåŠ¨æ¢å¤ä¸Šæ¬¡çš„è®¾ç½®çŠ¶æ€
